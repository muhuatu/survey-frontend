<div class="container">
  <!--------------------------- åŠŸèƒ½ --------------------------->
  <aside class="sidebar">
    <button
      routerLink="/question-settings"
      style="background-color: rgb(127, 116, 116); color: white"
    >
      è¨­å®šå•å·
    </button>
    <button (click)="submitToCheck()">ç¢ºèªå•å·</button>
    <button (click)="ban()">ç™¼å¸ƒå•å·</button>
    <button (click)="ban()">å•å·å›é¥‹</button>
  </aside>

  <!--------------------------- å•å·åŸºæœ¬è³‡è¨Š --------------------------->
  <main class="content">
    <div class="question-settings">
      <h2>æ–°å¢å•å·</h2>
      <div style="display: flex; gap: 10px">
        <label for="name">å•å·åç¨±ï¼š</label>
        <input class="name" type="text" [(ngModel)]="name" />
      </div>

      <div style="display: flex; gap: 10px">
        <label for="description">å•å·èªªæ˜ï¼š</label>
        <textarea
          [(ngModel)]="description"
          style="height: 50px; resize: vertical"
        ></textarea>
      </div>

      <div class="date" style="display: flex; gap: 10px">
        <label for="date">é–‹å§‹æ™‚é–“ï¼š</label>
        <input
          type="date"
          [min]="defaultDate"
          [(ngModel)]="startDate"
          (ngModelChange)="checkEndDate($event)"
          style="width: 149.8px"
        />
        <!-- ngModelChange åµæ¸¬åˆ° ngModel(é–‹å§‹æ—¥æœŸ) æ”¹è®Šå¾Œï¼Œä¾¿æœƒè§¸ç™¼æŒ‡å®šæ–¹æ³•checkEndDate(startDate: string)ã€‚
         å…¶ä¸­ $event æœƒè‡ªå‹•å¸¶å…¥æ–°çš„æ—¥æœŸå€¼ï¼Œç„¶å¾Œæ ¹æ“šå€¼ä¾†åˆ¤æ–·ä¸‹ä¸€æ­¥çš„çµæŸæ—¥æœŸä¸èƒ½å°æ–¼é–‹å§‹æ—¥æœŸã€‚
         -->

        <label for="date">çµæŸæ™‚é–“ï¼š</label>
        <input
          type="date"
          [min]="startDate"
          [(ngModel)]="endDate"
          style="width: 149.8px"
        />
      </div>

      <!--------------------------- å•é¡Œè¨­å®šå€ --------------------------->
      <h2>è¨­å®šå•é¡Œ</h2>
      <div style="display: flex; gap: 10px">
        <label for="questionName">å•é¡Œåç¨±ï¼š</label>
        <input type="text" [(ngModel)]="title" />
      </div>

      <div style="display: flex; gap: 10px">
        <label for="questionType">å•é¡Œé¡å‹ï¼š</label>
        <select [(ngModel)]="type">
          <option value="S">å–®é¸</option>
          <option value="M">å¤šé¸</option>
          <option value="T">ç°¡ç­”</option>
        </select>

        <div class="necessary">
          <input
            type="checkbox"
            name="necessary"
            [(ngModel)]="necessary"
            style="width: 16px"
          />
          <label for="necessary" style="font-size: 15px; margin-bottom: 3px"
            >å¿…å¡«</label
          >
        </div>
      </div>

      <!-- å–®é¸é¸é … -->
      @if(type === 'S'){
      <div
        style="
          display: flex;
          flex-direction: column;
          gap: 10px;
          margin-right: 30px;
        "
      >
        @for (option of options; track $index) {
        <div style="display: flex; align-items: center; gap: 10px">
          <input type="radio" style="width: 14px" disabled="disabled" />
          <input
            type="text"
            [(ngModel)]="option.answer"
            placeholder="è¼¸å…¥é¸é …"
            style="width: 200px"
          />
          <button class="button-delete" (click)="removeOption($index)">
            åˆªé™¤
          </button>
        </div>
        }
        <button class="button-add" (click)="addOption()">æ–°å¢é¸é …</button>
      </div>
      }

      <!-- å¤šé¸é¸é … -->
      @if(type === 'M'){
      <div
        style="
          display: flex;
          flex-direction: column;
          gap: 10px;
          margin-right: 30px;
        "
      >
        @for(option of options; track $index){
        <div style="display: flex; align-items: center; gap: 10px">
          <input type="checkbox" style="width: 14px" disabled="disabled" />
          <input
            type="text"
            [(ngModel)]="option.answer"
            placeholder="è¼¸å…¥é¸é …"
            style="width: 200px"
          />
          <button class="button-delete" (click)="removeOption($index)">
            åˆªé™¤
          </button>
        </div>
        }
        <button class="button-add" (click)="addOption()">æ–°å¢é¸é …</button>
      </div>
      }

      <!-- ç°¡ç­”è¼¸å…¥æ¡† -->
      @if(type === 'T'){
      <!-- <input type="text" [(ngModel)]="textAnswer" placeholder="è¼¸å…¥ç°¡ç­”æ–‡å­—" /> -->
      }

      <!-- æ–°å¢/ç·¨è¼¯æŒ‰éˆ• -->
      <button
        (click)="addQuestion()"
        style="
          margin: 0 0 20px 90px;
          width: 405px;
          height: 30px;
          background-color: white;
        "
      >
        {{ isEditing ? "ç·¨è¼¯å•é¡Œ" : "æ–°å¢å•é¡Œ" }}
      </button>
    </div>

    <!-- é»é¸ delete icon è¤‡æ•¸åˆªé™¤ -->
    <div>
      <!-- <link
        href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined"
        rel="stylesheet"
      /> -->
      <button class="icon-delete" (click)="deleteQuestions()">ğŸ—‘ï¸</button>
      <!-- <span class="material-symbols-outlined"> delete </span> -->
    </div>

    <!--------------------------- å•é¡Œè¡¨æ ¼é è¦½å€ --------------------------->
    <div class="mat-elevation-z8">
      <table mat-table [dataSource]="questionArray">
        <!-- é¸é …æ¬„ä½ -->
        <ng-container matColumnDef="checkbox">
          <th mat-header-cell *matHeaderCellDef style="width: 60px">é¸é …</th>
          <td mat-cell *matCellDef="let question">
            <input
              class="checkbox1"
              type="checkbox"
              [(ngModel)]="question.checkbox"
            />
          </td>
        </ng-container>

        <!-- ç·¨è™Ÿæ¬„ä½ -->
        <ng-container matColumnDef="questionId">
          <th mat-header-cell *matHeaderCellDef style="width: 80px">ç·¨è™Ÿ</th>
          <td mat-cell *matCellDef="let question">{{ question.questionId }}</td>
        </ng-container>

        <!-- åç¨±æ¬„ä½ -->
        <ng-container matColumnDef="title">
          <th mat-header-cell *matHeaderCellDef>å•é¡Œ</th>
          <td mat-cell *matCellDef="let question">{{ question.title }}</td>
        </ng-container>

        <!-- é¡å‹æ¬„ä½ -->
        <ng-container matColumnDef="type">
          <th mat-header-cell *matHeaderCellDef style="width: 80px">é¡å‹</th>
          <td mat-cell *matCellDef="let question">
            <ng-container [ngSwitch]="question.type">
              <span *ngSwitchCase="'S'">å–®é¸</span>
              <span *ngSwitchCase="'M'">å¤šé¸</span>
              <span *ngSwitchCase="'T'">ç°¡ç­” </span>
            </ng-container>
          </td>
        </ng-container>

        <!-- å¿…å¡«åˆ¤æ–·æ¬„ä½ -->
        <ng-container matColumnDef="necessary">
          <th mat-header-cell *matHeaderCellDef style="width: 70px">å¿…å¡«</th>
          <td mat-cell *matCellDef="let question">
            {{ question.necessary ? "ã€€âœ“" : "" }}
          </td>
        </ng-container>

        <!-- é¸é …æ¬„ä½ -->
        <ng-container matColumnDef="options">
          <th mat-header-cell *matHeaderCellDef>é¸é …</th>
          <td mat-cell *matCellDef="let question">
            @for(item of question.options; track $index){
            @if(question.options.length-1 != $index){
            {{ item.answer + "ã€" }}
            } @else {
            {{ item.answer }}
            } }
          </td>
        </ng-container>

        <!-- æ“ä½œæ¬„ä½ -->
        <ng-container matColumnDef="actions">
          <th mat-header-cell *matHeaderCellDef style="width: 120px">æ“ä½œ</th>
          <td mat-cell *matCellDef="let question">
            <div class="buttonDeleteEdit">
              <button
                class="button-delete"
                color="warn"
                style="margin-right: 10px"
                (click)="deleteQuestion(question.questionId)"
              >
                åˆªé™¤
              </button>
              <button
                class="button-edit"
                color="warn"
                (click)="editQuestion(question.questionId)"
              >
                ç·¨è¼¯
              </button>
            </div>
          </td>
        </ng-container>

        <!-- è¡¨æ ¼æ¨™é¡Œåˆ— -->
        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>

        <!-- è¡¨æ ¼è³‡æ–™åˆ— -->
        <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
      </table>
    </div>

    <!-- ä¸‹ä¸€æ­¥ -->
    <div class="step">
      <button (click)="submitToCheck()">é è¦½å•å·</button>
    </div>
  </main>
</div>
